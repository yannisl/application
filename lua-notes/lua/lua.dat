<!--
{{feature: .. Simplicity the art of maximizing the amount of work not done. The Agile Manifesto}}
{{feature-image:/codeigniter/images/underground_thumb.jpg}}
{{keywords: CodeIgniter,PHP, CodeIgniter, File helper class}}
{{author:Dr Y Lazarides}}
{{date:8 September 2008}}
{{category: PHP, MVC, Parsers}}
{{snippet:using CodeIgniter's file_helper class}}

-->


<h2>Strings</h2>


<div class="code-block console-wrap">
<div class="code-block code">

<code class="PHP">
----------------------------------------------------
-- Web server
-- Version 0.1
-- Copyright (c) 2008 Samuel Saint-Pettersen
-- Released under the GNU General Public License V3
-- See the COPYING file
----------------------------------------------------

-- load module for network connections
local socket = require("socket")

-- print message to show web server is running
print("Web server v0.1")
print("Copyright (c) 2008 Samuel Saint-Pettersen\n")
print("Running...")

-- create TCP socket on localhost:8080
local server = assert(socket.bind("*", 8080))
-- loop while waiting for a user agent request
while 1 do
	-- wait for a connection
	local client = server:accept()
	-- send response to confirm this is a web server
	client:send("HTTP/1.1 200/OK\r\nContent-Type:text/html\r\n\r\n")
	-- set timeout - 1 minute
	client:settimeout(60)
	-- receive request from user agent
	local request, err = client:receive()
	-- if there's no error, return the requested page
	if not err then 
		-- the server can be killed, by telnetting in
		-- and sending the request -> kill
		if request == "kill" then
			client:send("Web server killed.\n")
			print("Stopped.")
			break
		else
			-- detect operating system
			local os = os.getenv("WinDir")
			if os ~= nil then
				os = "Windows"
			else
				os = "Unix-like"
			end	
			-- resolve requested file from user agent request
			local file = string.match(request, "%l+%.?%l+")
			-- if no file mentioned in request, assume root file is index.html
			if file == nil then
				file = "index.html"
			end
			-- display requested file in browser
			local served = io.open("www/" .. file, "r")
			if served ~= nil then
				local content = served:read("*all")
				client:send(content)
			else
			-- display 404 message and server information
				client:send("<h3>404 Not Found!</h3>")
				client:send("<hr/>")
				client:send("<small>Lua web server v0.1 (" .. os ..")</small>")
			end
		end
	end
	-- done with client, close request
	client:close()
end
</code>
</div>
<div  id ="msg1" class="msg">
</div>
<div class="console"></div>
<button class="evalPerl">Run Code!</button>
<ol class="results"></ol> 
</div>



<div class="code-block console-wrap">
<div class="code-block code">

<code class="PHP">
-- sieve.lua
-- the sieve of Eratosthenes programmed with coroutines
-- typical usage: lua -e N=1000 sieve.lua | column

-- generate all the numbers from 2 to n


function gen (n)
  return coroutine.wrap(function ()
    for i=2,n do coroutine.yield(i) end
  end)
end

-- filter the numbers generated by `g', removing multiples of `p'
function filter (p, g)
  return coroutine.wrap(function ()
    while 1 do
      local n = g()
      if n == nil then return end
      if math.mod(n, p) ~= 0 then coroutine.yield(n) end
    end
  end)
end

N=N or 1000		-- from command line
x = gen(N)		-- generate primes up to N
while 1 do
  local n = x()		-- pick a number until done
  if n == nil then break end
  print(n)		-- must be a prime number
  x = filter(n, x)	-- now remove its multiples
end



</code>

</div>
<div  id ="msg1" class="msg">
</div>
<div class="console"></div>
<button class="evalPerl">Run Code!</button>
<ol class="results"></ol> 
</div>









                                                                                                                                                                                                                                                          